# DynamoDB 設計書

## 1. 概要

本システムでは、Amazon DynamoDBをExifメタデータの永続化ストアとして利用する。
スケーラビリティと低レイテンシーの要件を満たすため、NoSQLデータベースであるDynamoDBを選択する。

## 2. テーブル設計

- **テーブル名**: `ImageMetadata`
- **キャパシティモード**: オンデマンド (リクエストに応じて自動的にスケーリング)
- **項目 (アイテム)**:
    - 各項目は、1つの画像に対応するメタデータを格納する。
    - データモデルの詳細は `architecture-design-document.md` の「5. データモデル」を参照。

## 3. プライマリキーとインデックス

### 3.1. プライマリキー

- **パーティションキー**: `imageID` (String)
    - Lambdaで生成されるUUID v4を使用する。
    - これにより、書き込みと読み込みがパーティション全体に均等に分散されることが期待される。
- **ソートキー**: なし

### 3.2. グローバルセカンダリインデックス (GSI)

- **`fileName-index`**:
    - **パーティションキー**: `fileName`
    - **目的**: ファイル名からメタデータを検索するために使用する。
    - **プロジェクション**: 全ての属性 (`ALL`)

- **`uploadTimestamp-index`**:
    - **パーティションキー**: `uploadTimestamp`
    - **目的**: アップロード日時でメタデータを検索（特に期間指定検索）するために使用する。
    - **プロジェクション**: 全ての属性 (`ALL`)

## 4. バックアップと復元

- 本ハンズオンでは、ポイントインタイムリカバリ (PITR) やオンデマンドバックアップは設定しない。

## 5. ストリーム

- 本ハンズオンでは、DynamoDB Streamsは無効にする。