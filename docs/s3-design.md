# S3 設計書

## 1. 概要

本システムでは、Amazon S3を画像ファイルの永続的なストレージとして利用する。
アップロードされた画像はS3バケットに保存され、S3イベント通知を介してメタデータ抽出Lambdaをトリガーする。

## 2. バケット設計

- **バケット名**: `go-aws-handson-image-bucket-{your-account-id}`
    - ハンズオン参加者ごとに一意のバケット名になるよう、AWSアカウントIDなどをサフィックスとして付与する。
- **リージョン**: `ap-northeast-1` (東京)
- **オブジェクトキーの構造**:
    - `uploads/{uuid}/{fileName}`
    - UUIDをパスに含めることで、同じファイル名でもオブジェクトが上書きされることを防ぐ。

## 3. アクセス制御

- **パブリックアクセス**: 全てのパブリックアクセスをブロックする。
- **アクセス方法**:
    - **アップロード**: 署名付きURL発行Lambdaによって生成された署名付きURL (`PutObject`) を使用する。
    - **ダウンロード**: メタデータ抽出Lambdaが `s3:GetObject` 権限を持つIAMロールを使用してアクセスする。
- **バケットポリシー**: 設定しない。IAMロールベースのアクセス制御のみとする。

## 4. イベント通知

- **イベントタイプ**: `s3:ObjectCreated:Put`
- **プレフィックス**: `uploads/`
- **送信先**: メタデータ抽出Lambda

## 5. ライフサイクル管理

- 本ハンズオンでは、ライフサイクルルールは設定しない。
- オブジェクトは手動または `cdk destroy` 後のクリーンアップスクリプトで削除する。

## 6. バージョニング

- バージョニングは無効にする。