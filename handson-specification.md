## 🚀 AWS構築＆Go開発ハンズオン最終仕様書

### 1. アプリケーション概要

| 項目 | 仕様 |
| :--- | :--- |
| **タイトル** | Go & Serverless: GitHub Actionsで構築する画像メタデータ・インスペクター |
| **目的** | S3にアップロードされた画像（JPEG/TIFF）からGo LambdaがExifメタデータを抽出し、DynamoDBに永続化するシステムを構築する。 |
| **開発言語** | **Go (Golang)** |
| **CI/CDツール**| **GitHub Actions** を使用した自動デプロイメントパイプラインの構築。 |
| **開発補助** | **Gemini CLI** をハンズオンのドキュメント作成やコーディング補助に活用。 |
| **セキュリティ** | **最小権限の原則**に従い、IAMロールを設定する。 |

***

### 2. 環境要件と前提条件

| 分野 | 要件 |
| :--- | :--- |
| **AWSアカウント** | **新規アカウント**を作成し、**無料プラン (Free Plan)** を選択する。 |
| **無料枠の注意** | S3は12ヶ月無料枠（または新しい無料プランのクレジット消費対象）のため、**ハンズオン終了後、全リソースを削除**することを徹底する。 |
| **ローカル環境** | macOS/Linux環境。**Go言語がインストール済みであること**。 |
| **ローカルエミュレーション** | 開発・単機能テスト用に **MinIO (S3代替)** および **DynamoDB Local** をDockerで利用する。 |
| **フォルダ構成** | Goのベストプラクティス (`cmd`, `internal`, `pkg`) に従う。 |

***

### 3. AWSサービス構成と役割

| サービス | 役割 | 無料枠 | 備考 |
| :--- | :--- | :--- | :--- |
| **AWS Lambda (Go)** | **3つの関数**を使用する。 | 常時無料枠 | **① 署名付きURL発行関数**（API Gateway連携）、**② メタデータ抽出関数**（S3トリガー）、**③ メタデータ検索関数**（API Gateway連携）。 |
| **Amazon S3** | **画像ファイルの保存先**。S3イベント通知でLambdaをトリガーする。 | 12ヶ月/クレジット | 終了後の削除必須。 |
| **Amazon DynamoDB**| 抽出した**メタデータ（NoSQL）の永続化**。 | 常時無料枠 | |
| **API Gateway** | **署名付きURL発行 Lambda** を公開するためのエンドポイント。 | 常時無料枠 | |
| **CloudWatch Logs**| Lambdaの実行ログ（`stdout`/`stderr`）の自動収集・保存。 | 常時無料枠 | |
| **GitHub Actions** | Goのビルド、テスト、AWSへのデプロイを自動化。 | 無料 | AWS OIDC認証を推奨。 |

***

### 4. 開発仕様とGoロギング

| 項目 | 仕様 |
| :--- | :--- |
| **Go ライブラリ** | `github.com/rwcarlsen/goexif/exif` などのGo用Exif抽出ライブラリを使用する。 |
| **ロギング** | **`go.uber.org/zap`** などの構造化ロガーライブラリを使用する。 |
| **ログ出力先** | ロガーの出力先を**標準出力 (`os.Stdout`)** に設定し、**CloudWatch Logsへ自動転送**させる。 |
| **ログレベル制御**| Lambdaの**環境変数 `LOG_LEVEL`** (例: `INFO`, `DEBUG`) を設定することで、外部からログの出力レベルを動的に操作できるようにする。 |
| **APIデータフロー** | **クライアント** → **API Gateway** → **Lambda(発行)** → **S3署名付きURL** → **クライアント** → **S3アップロード** → **S3イベント** → **Lambda(抽出)** → **DynamoDB** |

***

### 5. 作業プロセス（ハンズオンの流れ）

1.  **環境セットアップ:** Go、Docker、AWS CLI、Gemini CLIの準備。
2.  **ローカルエミュレーション:** DynamoDB Local / MinIOの起動。
3.  **Go開発（単体テスト）:** Goでのメタデータ抽出ロジック、DynamoDBリポジトリ層のユニットテスト。
4.  **Go開発（統合テスト）:** Lambdaハンドラのローカルでの動作確認。
5.  **GitHub / AWS リソース定義:** IAM、S3、DynamoDBの定義。
6.  **CI/CD構築:** GitHub Actions (`ci-cd.yml`) の設定とGitHubへのプッシュ。
7.  **AWS環境での動作確認:** エンドツーエンドのAPIテストとCloudWatch Logsでのログ確認。
8.  **リソースクリーンアップ:** AWS環境の全ての有料リソースを削除。